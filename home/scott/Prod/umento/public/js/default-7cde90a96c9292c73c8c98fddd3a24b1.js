(function(){var a;a=window.Umento=window.Umento||{},a.socket=io.connect("/",{"sync disconnect on unload":!0})}).call(this),function(){var a,b,c={}.hasOwnProperty,d=function(a,b){function e(){this.constructor=a}for(var d in b)c.call(b,d)&&(a[d]=b[d]);return e.prototype=b.prototype,a.prototype=new e,a.__super__=b.prototype,a};return b=window.Umento=window.Umento||{},a=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return d(b,a),b.prototype.assign=function(a,b){return a.setElement(this.$(b)).render()},b}(Backbone.View),b.UmView=a,a}.call(this),function(){var ns;ns=window.Umento=window.Umento||{},ns.requireCache=[],ns.require=function(urlOfSomeFile){var cacheItem,dataType,moduleVal,result,_i,_len,_ref;dataType=null,urlOfSomeFile.indexOf(".html",urlOfSomeFile.length-5)!==-1?dataType="text":(dataType="script",urlOfSomeFile.indexOf(".js",urlOfSomeFile.length-3)===-1&&(urlOfSomeFile+=".js")),_ref=ns.requireCache;for(_i=0,_len=_ref.length;_i<_len;_i++){cacheItem=_ref[_i];if(cacheItem.url===urlOfSomeFile)return cacheItem.val}return result=jQuery.ajax({async:!1,url:urlOfSomeFile,dataType:dataType}),moduleVal=result.responseText,dataType==="script"&&(moduleVal=eval(moduleVal)),ns.requireCache.push({url:urlOfSomeFile,val:moduleVal}),moduleVal}}.call(this),function(){var a,b,c,d,e,f,g={}.hasOwnProperty,h=function(a,b){function d(){this.constructor=a}for(var c in b)g.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};return d=window.Umento=window.Umento||{},e=d.socket,c=d.UmView,f=d.require("/templates/ConnectedUsers.html"),a=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return h(b,a),b.prototype.defaults=function(){return{count:0}},b}(Backbone.Model),b=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return h(b,a),b.prototype.tagName="h1",b.prototype.template=function(){return _.template(f,this.model.toJSON())},b.prototype.initialize=function(){return this.model.on("change:count",function(){return this.render()},this),e.on("connectedUsers",_.bind(function(a){return this.model.set("count",a.count)},this)),this.render()},b.prototype.render=function(){return this.$el.html(this.template()),this},b}(c),d.ConnectedUsersAPI={},d.ConnectedUsersAPI.ConnectedUsers=a,d.ConnectedUsersAPI.ConnectedUsersView=b,d.ConnectedUsersAPI}.call(this),function(){var a,b,c,d,e,f,g,h,i={}.hasOwnProperty,j=function(a,b){function d(){this.constructor=a}for(var c in b)i.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};return f=window.Umento=window.Umento||{},g=f.socket,e=f.UmView,h=f.require("/templates/Message.html"),a=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return j(b,a),b.prototype.defaults=function(){return{ts:moment().format("YYYY-MM-DDTHH:mm:ss"),nickname:"Guest",message:""}},b}(Backbone.Model),b=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return j(b,a),b.prototype.tagName="article",b.prototype.className="message",b.prototype.template=function(){return _.template(h,this.model.toJSON())},b.prototype.initialize=function(){return this.model.on("change",function(){return this.render()},this),this.render()},b.prototype.render=function(){return this.$el.html(this.template()),this},b}(e),c=function(b){function c(){return c.__super__.constructor.apply(this,arguments)}return j(c,b),c.prototype.model=a,c.prototype.url="#",c}(Backbone.Collection),d=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return j(c,a),c.prototype.tagName="section",c.prototype.AddOne=function(a){var c;return c=new b({model:a}),this.$el.prepend(c.el)},c.prototype.AddAll=function(){return this.$el.empty(),this.collection.each(this.AddOne)},c.prototype.initialize=function(){return this.AddOne=_.bind(this.AddOne,this),this.AddAll=_.bind(this.AddAll,this),this.collection.on("reset",this.AddAll),this.collection.on("add",this.AddOne),g.on("chatMessage",_.bind(function(a){return this.collection.add(a)},this)),g.on("chatCorrection",_.bind(function(a){return this.collection.at(a.index).set("nickname",a.nickname)},this)),this.render()},c.prototype.render=function(){return this.AddAll(),this},c}(e),f.MessageAPI={},f.MessageAPI.Message=a,f.MessageAPI.MessageView=b,f.MessageAPI.Messages=c,f.MessageAPI.MessagesView=d,f.MessageAPI}.call(this),function(){var a,b,c,d,e,f,g,h={}.hasOwnProperty,i=function(a,b){function d(){this.constructor=a}for(var c in b)h.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};return e=window.Umento=window.Umento||{},f=e.socket,d=e.UmView,c=e.MessageAPI,g=e.require("/templates/Home.html"),a=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return i(b,a),b.prototype.defaults=function(){return{connected:!1}},b}(Backbone.Model),b=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return i(b,a),b.prototype.tagName="div",b.prototype.template=function(){return _.template(g,this.model.toJSON())},b.prototype.initialize=function(a){return this.EmitVal=_.bind(this.EmitVal,this),this.ConnectedUsersView=a.ConnectedUsersView,this.MessagesView=a.MessagesView,this.model.on("change:connected",function(){return this.render()},this),f.on("connect",_.bind(function(){return this.model.set("connected",!0)},this)),f.on("disconnect",_.bind(function(){return this.model.set("connected",!1)},this)),this.render()},b.prototype.EmitVal=function(){var a,b,d,e;d=$("#nick").val(),b=$("#inVal"),e=b.val();if(e.length>0&&f!=null)return a={ts:moment().format("YYYY-MM-DDTHH:mm:ss"),message:e},d!=null&&d.length>0&&(a.nickname=d),this.MessagesView.collection.add(new c.Message(a)),a.index=this.MessagesView.collection.length-1,f.emit("chatMessage",a),b.val("")},b.prototype.events={"click a":function(a){return a.preventDefault(),this.EmitVal()},keypress:function(a){if(a.which===13)return a.preventDefault(),this.EmitVal()}},b.prototype.render=function(){return this.$el.html(this.template()),this.assign(this.ConnectedUsersView,".connectedUsers"),this.assign(this.MessagesView,".messages"),this},b}(d),e.HomeAPI={},e.HomeAPI.Home=a,e.HomeAPI.HomeView=b,e.HomeAPI}.call(this),function(){var a,b,c,d,e;d=window.Umento=window.Umento||{},e=d.socket,b=d.HomeAPI,c=d.MessageAPI,a=d.ConnectedUsersAPI,$(function(){var d,f,g,h,i,j,k,l,m;m=JSON.parse($("#hdnMessages").val()),k=new c.Messages(m.reverse()),l=new c.MessagesView({collection:k}),f=new a.ConnectedUsers({}),g=new a.ConnectedUsersView({model:f}),h=new b.Home({}),i=new b.HomeView({el:$(".mainsection"),model:h,ConnectedUsersView:g,MessagesView:l}),d=function(){if(e.socket.connected)return h.set("connected",!0),clearInterval(j)},j=setInterval(d,1500)})}.call(this)