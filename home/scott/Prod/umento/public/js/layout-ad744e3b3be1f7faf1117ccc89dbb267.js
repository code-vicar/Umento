(function(){var a;a=window.Umento=window.Umento||{},a.socket=io.connect("/",{"sync disconnect on unload":!0})}).call(this),function(){var a,b,c={}.hasOwnProperty,d=function(a,b){function e(){this.constructor=a}for(var d in b)c.call(b,d)&&(a[d]=b[d]);return e.prototype=b.prototype,a.prototype=new e,a.__super__=b.prototype,a};return b=window.Umento=window.Umento||{},a=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return d(b,a),b.prototype.assign=function(a,b){return a.setElement(this.$(b)).render()},b}(Backbone.View),b.UmView=a,a}.call(this),function(){var ns;ns=window.Umento=window.Umento||{},ns.requireCache=[],ns.require=function(urlOfSomeFile){var cacheItem,dataType,moduleVal,result,_i,_len,_ref;dataType=null,urlOfSomeFile.indexOf(".html",urlOfSomeFile.length-5)!==-1?dataType="text":(dataType="script",urlOfSomeFile.indexOf(".js",urlOfSomeFile.length-3)===-1&&(urlOfSomeFile+=".js")),_ref=ns.requireCache;for(_i=0,_len=_ref.length;_i<_len;_i++){cacheItem=_ref[_i];if(cacheItem.url===urlOfSomeFile)return cacheItem.val}return result=jQuery.ajax({async:!1,url:urlOfSomeFile,dataType:dataType}),moduleVal=result.responseText,dataType==="script"&&(moduleVal=eval(moduleVal)),ns.requireCache.push({url:urlOfSomeFile,val:moduleVal}),moduleVal}}.call(this),function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p={}.hasOwnProperty,q=function(a,b){function d(){this.constructor=a}for(var c in b)p.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};return l=window.Umento=window.Umento||{},n=l.socket,h=l.UmView,o=l.require("/templates/Login.html"),f="New?",b="Cancel",g="Sign In",a="Account",c="Create",m=function(a){var b;return b=a.$el.find("#accountForm"),a.$el.find("#btnLogin span").html(g),b.fadeIn("slow",function(){return b.find("input").first().focus(),a.$el.trigger("focusin")})},k=function(b){var c;return c=b.$el.find("#accountForm"),b.$el.find("#btnLogin span").html(a),c.fadeOut("fast")},i=function(a){var d,e,f,g;return d=a.$el.find("#accountForm"),g=d.find("fieldset[name=email]"),f=a.$el.find("#btnNew"),e=a.$el.find("#btnLogin"),f.find("span").html(b),e.find("span").html(c),g.fadeIn("slow")},j=function(a){var b,c,d,e;return b=a.$el.find("#accountForm"),e=b.find("fieldset[name=email]"),d=a.$el.find("#btnNew"),c=a.$el.find("#btnLogin"),d.find("span").html(f),c.find("span").html(g),e.fadeOut("slow")},d=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return q(b,a),b.prototype.defaults=function(){return{username:""}},b}(Backbone.Model),e=function(b){function d(){return d.__super__.constructor.apply(this,arguments)}return q(d,b),d.prototype.tagName="div",d.prototype.className="login",d.prototype.template=function(){return _.template(o,this.model.toJSON())},d.prototype.initialize=function(){var a;return _.bind(this.btnLoginActivate,this),_.bind(this.btnNewActivate,this),_.bind(this.keepOpen,this),_.bind(this.startHide,this),_.bind(this.signInResult,this),_.bind(this.createResult,this),_.bind(this.render,this),a=this,n.on("login",function(b){return a.signInResult(b)}),n.on("createAccount",function(b){return a.createResult(b)}),this.model.on("change",function(){return a.render()}),this.render()},d.prototype.events={"click #btnLogin":"btnLoginActivate","keyup #btnLogin":"btnLoginActivate","click #btnNew":"btnNewActivate","keyup #btnNew":"btnNewActivate",focusin:"keepOpen",focusout:"startHide"},d.prototype.signInResult=function(a){var b;return a.result?this.model.set("username",a.username):(b=this.$el.find(".message"),b.html("Incorrect Sign In"),b.fadeIn("fast",function(){return setTimeout(function(){return b.fadeOut("fast")},1500)}))},d.prototype.createResult=function(a){var b;return a.result?this.model.set("username",a.username):(b=this.$el.find(".message"),b.html("Could Not Create Account"),b.fadeIn("fast",function(){return setTimeout(function(){return b.fadeOut("fast")},1500)}))},d.prototype.btnNewActivate=function(a){var b,c;if(a.type==="keyup"&&a.which!=null&&a.which!==13)return;return b=$(a.target),b.prop("tagName").toLowerCase()==="a"&&(b=b.find("span")),c=b.html(),c===f?i(this):j(this)},d.prototype.btnLoginActivate=function(b){var d,e,f,h,i;if(b.type==="keyup"&&b.which!=null&&b.which!==13)return;d=$(b.target),d.prop("tagName").toLowerCase()==="a"&&(d=d.find("span")),e=d.html();if(e===a)return m(this);if(e===g){h=$("#username").val(),i=$("#password").val();if(n!=null&&h.length>0&&i.length>0)return n.emit("login",{username:h,password:i})}else if(e===c){h=$("#username").val(),f=$("#email").val(),i=$("#password").val();if(n!=null&&h.length>0&&i.length>0)return n.emit("createAccount",{username:h,email:f,password:i})}},d.prototype.keepOpen=function(){if(this.displayTimeoutID!=null)return clearTimeout(this.displayTimeoutID)},d.prototype.startHide=function(){var a;return a=this,this.displayTimeoutID!=null&&clearTimeout(this.displayTimeoutID),this.displayTimeoutID=setTimeout(function(){return k(a)},3e3)},d.prototype.render=function(){return this.$el.html(this.template()),this},d}(h),l.LoginAPI={},l.LoginAPI.Login=d,l.LoginAPI.LoginView=e,l.LoginAPI}.call(this),function(){var a,b,c,d,e;d=window.Umento=window.Umento||{},a=d.LoginAPI,e=$("#hdnUsername").val(),b=new a.Login({username:e}),c=new a.LoginView({model:b,el:".login"})}.call(this)